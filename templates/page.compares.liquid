{{ page.content }}
<h2 style="text-align: center;">{{page.title}}</h2>
<style>
    .product-list {
        list-style: none;
        padding: 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
    }

    .product {
        margin: 10px;
        flex: 0 0 calc(25% - 20px);
        /* 每个产品宽度为 25% - margin */
        box-sizing: border-box;
        /* 包括边框在内的宽度计算 */
    }

    .product-header {
        text-align: center;
    }

    .product-header img {
        max-width: 100%;
        /* 图片最大宽度为 100% */
        height: auto;
    }

    .product-title {
        font-size: 16px;
        font-weight: bold;
    }

    .product-params span {
        display: block;
        text-align: center;
        margin: 3px 0;
        border: 1px solid #ddd;
        padding: 7px 0;
    }

    @media (max-width: 1200px) {
        .product {
            flex: 0 0 calc(33.33% - 20px);
            /* 在屏幕较小的情况下，每个产品宽度为 33.33% - margin */
        }
    }

    @media (max-width: 800px) {
        .product {
            flex: 0 0 calc(50% - 20px);
            /* 在屏幕更小的情况下，每个产品宽度为 50% - margin */
        }
    }

    @media (max-width: 600px) {
        .product {
            flex: 0 0 calc(100% - 20px);
            /* 在屏幕非常小的情况下，每个产品宽度为 100% - margin */
        }
    }
</style>
<div class="page-width">
    <div class="main-compares">
        
        <ul class="product-list">
            <li id="whereToPlaceSelect">

            </li>

        </ul>
    </div>
</div>
{% assign product_info_json = page.metafields.global.comparison_parameters.value %}
<script>
    var allProductInfo = {{ product_info_json | json }};
    var numberOfSelects = 4; // 总共需要展示的产品数量
    var productHandles;

    document.addEventListener('DOMContentLoaded', function () {
        var params = new URLSearchParams(window.location.search);
        productHandles = params.get('handles') ? params.get('handles').split(',') : [];

        var handlesCount = productHandles.length;

        // 检查handles数量是否在2到4之间
        if (handlesCount >= 2 && handlesCount <= 4) {
            productHandles.forEach(function (handle) {
                fetchProductInfoByHandle(handle);
            });

            numberOfSelects -= handlesCount; // 减去handles的数量
        } else if (handlesCount > 0) {
            // 如果handles数量不在2到4之间，可以在这里处理
            alert("The number of product handles must be between 2 and 4.");
            return; // 终止执行
        }

        // 生成剩余的下拉选择框
        for (var i = 0; i < numberOfSelects; i++) {
            fetchAndCreateSelect(i);
        }
    });



    function fetchProductInfoByHandle(handle) {
        $.get('/products/' + handle + '.js', function (response) {
            // console.log(product)
            var product = JSON.parse(response);
            console.log(product.title)
            var productHtml = '<li class="product">' +
                '<div class="product-header">' +
                '<img src="' + product.featured_image + '" alt="' + product.title + '">' +
                '<div class="product-title">' + product.title + '</div>' +
                '</div>';

            if (allProductInfo[handle]) {
                var productParamsHtml = '<div class="product-params">';
                Object.keys(allProductInfo[handle]).forEach(function (key) {
                    productParamsHtml += '<span>' + key + ': ' + allProductInfo[handle][key] + '</span>';
                });
                productParamsHtml += '</div>';
                productHtml += productParamsHtml;
            }

            productHtml += '</li>';
            $('.product-list').append(productHtml);
        }).fail(function () {
            console.error("Error fetching product information for handle:", handle);
        });
    }

    function fetchAndCreateSelect(index) {
        $.get('/collections/wood-pellet-grills/products.json', function (data) {
            var products = data.products;
            var selectHtml = '<select id="productSelect' + index + '">';

            products.forEach(function (product) {
                selectHtml += '<option value="' + product.handle + '">' + product.title + '</option>';
            });

            selectHtml += '</select>';
            $('#whereToPlaceSelect').append(selectHtml);

            $('#productSelect' + index).on('change', function () {
                var selectedHandle = $(this).val();

                // 计算当前已经展示的产品数量
                var displayedProductCount = $('.product-list .product').length;
                var handlesCount = productHandles ? productHandles.split(',').length : 0;

                // 检查是否还有空间添加新产品
                if (displayedProductCount + handlesCount < numberOfSelects) {
                    fetchProductInfoByHandle(selectedHandle);
                } else {
                    // 超出最大产品数量时的处理逻辑
                    alert("You cannot select more than " + numberOfSelects + " products.");
                }
            });
        }).fail(function () {
            console.error("Error fetching products from the collection");
        });
    }






    // $.get('/collections/wood-pellet-grills/products.json', function (data) {
    //     var products = data.products;
    //     var selectHtml = '<select id="productSelect">';

    //     products.forEach(function (product) {
    //         selectHtml += '<option value="' + product.handle + '">' + product.title + '</option>';
    //     });

    //     selectHtml += '</select>';
    //     $('#whereToPlaceSelect').html(selectHtml);
    //     $('#productSelect').on('change', function () {
    //         var selectedHandle = $(this).val();
    //         if (allProductInfo[selectedHandle]) {
    //             var productData = allProductInfo[selectedHandle];
    //             console.log(productData); // 处理和展示数据
    //         }
    //     });
    // }).fail(function () {
    //     console.error("Error fetching products from the collection");
    // });





</script>