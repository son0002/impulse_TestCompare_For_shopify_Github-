{{ page.content }}
<h2 style="text-align: center;">{{page.title}}</h2>
<style>
    .main-compares {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        /* 创建四列，每列等宽 */
        gap: 10px;
    }

    #whereToPlaceSelect {
        grid-column: 1;
        /* whereToPlaceSelect 占据第一列 */
    }

    .product-list {
        grid-column: 2 / 5;
        /* product-list 占据第二列到第四列 */
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        list-style: none;
        padding: 0;
    }

    .product {
        flex: 0 0 calc(100% - 10px);
        /* 每个产品占据全部宽度，减去间隙 */
        box-sizing: border-box;
    }

    .product-header {
        text-align: center;
    }

    .product-header img {
        max-width: 100%;
        /* 图片最大宽度为 100% */
        height: auto;
    }

    .product-title {
        font-size: 16px;
        font-weight: bold;
    }

    .product-params span {
        display: block;
        text-align: center;
        margin: 3px 0;
        border: 1px solid #ddd;
        padding: 7px 0;
    }

    @media (max-width: 800px) {
        .main-compares {
            grid-template-columns: 1fr;
            /* 在较小屏幕上，切换到单列布局 */
        }

        #whereToPlaceSelect,
        .product-list {
            grid-column: 1;
            /* 所有元素占据整个宽度 */
        }

        .product {
            flex: 0 0 calc(100% - 10px);
            /* 同样占据全部宽度 */
        }
    }
</style>
<div class="page-width">
    <div class="main-compares">
        <div id="whereToPlaceSelect">

        </div>
        <ul class="product-list">

        </ul>
    </div>
</div>
{% assign product_info_json = page.metafields.global.comparison_parameters.value %}
<script>
    var allProductInfo = {{ product_info_json | json }};

    document.addEventListener('DOMContentLoaded', function () {
        var params = new URLSearchParams(window.location.search);
        var productHandles = params.get('handles');
        var numberOfSelects = 4; // 总共需要展示的产品数量

        if (productHandles) {
            var handlesArray = productHandles.split(',');
            var handlesCount = handlesArray.length;

            // 检查handles数量是否在2到4之间
            if (handlesCount >= 2 && handlesCount <= 4) {
                // 根据handles生成对应的产品信息
                handlesArray.forEach(function (handle) {
                    fetchProductInfoByHandle(handle);
                });

                numberOfSelects -= handlesCount; // 减去handles的数量
            } else {
                // 如果handles数量不在2到4之间，可以在这里处理
                alert("The number of product handles must be between 2 and 4.");
                return; // 终止执行
            }
        }

        // 生成剩余的下拉选择框
        for (var i = 0; i < numberOfSelects; i++) {
            fetchAndCreateSelect(i);
        }
    });


    function fetchProductInfoByHandle(handle) {
        $.get('/products/' + handle + '.js', function (response) {
            // console.log(product)
            var product = JSON.parse(response);
            console.log(product.title)
            var productHtml = '<li class="product">' +
                '<div class="product-header">' +
                '<img src="' + product.featured_image + '" alt="' + product.title + '">' +
                '<div class="product-title">' + product.title + '</div>' +
                '</div>';

            if (allProductInfo[handle]) {
                var productParamsHtml = '<div class="product-params">';
                Object.keys(allProductInfo[handle]).forEach(function (key) {
                    productParamsHtml += '<span>' + key + ': ' + allProductInfo[handle][key] + '</span>';
                });
                productParamsHtml += '</div>';
                productHtml += productParamsHtml;
            }

            productHtml += '</li>';
            $('.product-list').append(productHtml);
        }).fail(function () {
            console.error("Error fetching product information for handle:", handle);
        });
    }

    function fetchAndCreateSelect(index) {
        $.get('/collections/wood-pellet-grills/products.json', function (data) {
            var products = data.products;
            var selectHtml = '<select id="productSelect' + index + '">';

            products.forEach(function (product) {
                selectHtml += '<option value="' + product.handle + '">' + product.title + '</option>';
            });

            selectHtml += '</select>';
            $('#whereToPlaceSelect').append(selectHtml); // 添加下拉框到页面

            $('#productSelect' + index).on('change', function () {
                var selectedHandle = $(this).val();
                fetchProductInfoByHandle(selectedHandle); // 使用fetchProductInfoByHandle获取选中的产品信息
            });
        }).fail(function () {
            console.error("Error fetching products from the collection");
        });
    }



    // $.get('/collections/wood-pellet-grills/products.json', function (data) {
    //     var products = data.products;
    //     var selectHtml = '<select id="productSelect">';

    //     products.forEach(function (product) {
    //         selectHtml += '<option value="' + product.handle + '">' + product.title + '</option>';
    //     });

    //     selectHtml += '</select>';
    //     $('#whereToPlaceSelect').html(selectHtml);
    //     $('#productSelect').on('change', function () {
    //         var selectedHandle = $(this).val();
    //         if (allProductInfo[selectedHandle]) {
    //             var productData = allProductInfo[selectedHandle];
    //             console.log(productData); // 处理和展示数据
    //         }
    //     });
    // }).fail(function () {
    //     console.error("Error fetching products from the collection");
    // });





</script>